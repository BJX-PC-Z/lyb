<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>简易留言板（GitHub Issues后端）</title>
  <style>
    body { font-family: 'Helvetica Neue',Arial,sans-serif; background: #fafafa; margin: 0; padding: 0; }
    .container { max-width: 600px; margin: 40px auto; padding: 24px; background: #fff; border-radius: 8px; box-shadow: 0 2px 12px #eee; }
    h1 { font-size: 2em; margin-bottom: 0.4em; }
    form { margin-bottom: 1.4em; }
    textarea { width: 100%; min-height: 70px; font-size: 1em; padding: 10px; border-radius: 6px; border: 1px solid #ddd; margin-bottom: 10px; }
    button { padding: 8px 24px; border: none; background: #007aff; color: #fff; border-radius: 6px; cursor: pointer; font-size: 1em; }
    button:disabled { background: #ccc; cursor: not-allowed; }
    .msg-list { list-style: none; padding: 0; margin: 0; }
    .msg-item { border-bottom: 1px solid #eee; padding: 14px 0; }
    .msg-content { white-space: pre-wrap; word-break: break-all; }
    .msg-meta { font-size: 0.85em; color: #888; margin-top: 4px; }
    @media (max-width: 700px) { .container { margin: 0; border-radius: 0; } }
  </style>
</head>
<body>
  <div class="container">
    <h1>留言板</h1>
    <form id="msgForm">
      <textarea id="msgInput" placeholder="写下你的留言吧！无需账号，大家都能看到。" required maxlength="200"></textarea>
      <button type="submit" id="sendBtn">发送</button>
    </form>
    <ul class="msg-list" id="msgList"></ul>
  </div>
  <script>
    // ====== 请在下方填写你的仓库信息和Token ======
    const owner = '你的github用户名';     // 示例：BJX-PC-Z
    const repo = '你的仓库名';           // 示例：my-message-board
    const GITHUB_TOKEN = '你的github-token'; // 强烈建议仅用于演示，勿用于生产环境
    // =========================================

    // 获取留言（issue列表，只展示加了“留言”标签的）
    async function loadMsgs() {
      const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/issues?labels=留言&state=open`);
      const data = await res.json();
      renderMsgs(data);
    }

    // 渲染留言
    function renderMsgs(msgs) {
      const list = document.getElementById('msgList');
      list.innerHTML = '';
      msgs.forEach(msg => {
        const li = document.createElement('li');
        li.className = 'msg-item';
        li.innerHTML = `
          <div class="msg-content">${escapeHtml(msg.title)}</div>
          <div class="msg-meta">${formatDate(msg.created_at)} by ${msg.user.login}</div>
        `;
        list.appendChild(li);
      });
    }

    // 发送留言（直接创建Issue）
    document.getElementById('msgForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const btn = document.getElementById('sendBtn');
      btn.disabled = true;
      const content = document.getElementById('msgInput').value.trim();
      if (!content) { btn.disabled = false; return; }
      // 创建Issue
      const res = await fetch(`https://api.github.com/repos/${owner}/${repo}/issues`, {
        method: 'POST',
        headers: {
          'Authorization': `token ${GITHUB_TOKEN}`,
          'Accept': 'application/vnd.github.v3+json',
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          title: content,
          labels: ['留言']
        })
      });
      if (res.ok) {
        document.getElementById('msgInput').value = '';
        loadMsgs();
      } else {
        alert('留言失败！请检查Token权限或API限制。');
      }
      btn.disabled = false;
    });

    // 加载留言
    loadMsgs();
    setInterval(loadMsgs, 15000);

    // 工具函数
    function escapeHtml(str) {
      return str.replace(/[<>"&]/g, (c) => ({
        '<': '&lt;', '>': '&gt;', '"': '&quot;', '&': '&amp;'
      }[c]));
    }
    function formatDate(d) {
      const date = new Date(d);
      return date.toLocaleString('zh-CN', { hour12: false });
    }
  </script>
</body>
</html>
